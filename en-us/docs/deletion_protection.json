{
  "filename": "deletion_protection.md",
  "__html": "<h1 id=\"deletion-protection\">Deletion Protection <a class=\"header-anchor\" href=\"#deletion-protection\">#</a></h1>\n<p><strong>FEATURE STATE:</strong> Kruise v0.9.0</p>\n<p>This feature provides a safety policy which could help users protect Kubernetes resources and\napplications' availability from the cascading deletion mechanism.</p>\n<h2 id=\"usage\">Usage <a class=\"header-anchor\" href=\"#usage\">#</a></h2>\n<p>Firstly, users have to enable the <code>ResourcesDeletionProtection</code> feature-gate during <a href=\"./installation.html#optional%3A-feature-gate\">Kruise installation or upgrade</a>.</p>\n<p>Then, users can add the label named <code>policy.kruise.io/delete-protection</code> to some specific resources. The values can be:</p>\n<ul>\n<li><code>Always</code>: this object will always be forbidden to be deleted, unless the label is removed</li>\n<li><code>Cascading</code>: this object will be forbidden to be deleted, if it has active resources owned</li>\n</ul>\n<p>The resources supported and the cascading judgement relationship:</p>\n<table>\n<thead>\n<tr>\n<th>Kind</th>\n<th>Group</th>\n<th>Version</th>\n<th><strong>Cascading</strong> judgement</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>Namespace</code></td>\n<td>core</td>\n<td>v1</td>\n<td>whether there is active Pods in this namespace</td>\n</tr>\n<tr>\n<td><code>CustomResourceDefinition</code></td>\n<td><a href=\"http://apiextensions.k8s.io\">apiextensions.k8s.io</a></td>\n<td>v1beta1, v1</td>\n<td>whether there is existing CRs of this CRD</td>\n</tr>\n<tr>\n<td><code>Deployment</code></td>\n<td>apps</td>\n<td>v1</td>\n<td>whether the replicas is 0</td>\n</tr>\n<tr>\n<td><code>StatefulSet</code></td>\n<td>apps</td>\n<td>v1</td>\n<td>whether the replicas is 0</td>\n</tr>\n<tr>\n<td><code>ReplicaSet</code></td>\n<td>apps</td>\n<td>v1</td>\n<td>whether the replicas is 0</td>\n</tr>\n<tr>\n<td><code>CloneSet</code></td>\n<td><a href=\"http://apps.kruise.io\">apps.kruise.io</a></td>\n<td>v1alpha1</td>\n<td>whether the replicas is 0</td>\n</tr>\n<tr>\n<td><code>StatefulSet</code></td>\n<td><a href=\"http://apps.kruise.io\">apps.kruise.io</a></td>\n<td>v1alpha1, v1beta1</td>\n<td>whether the replicas is 0</td>\n</tr>\n<tr>\n<td><code>UnitedDeployment</code></td>\n<td><a href=\"http://apps.kruise.io\">apps.kruise.io</a></td>\n<td>v1alpha1</td>\n<td>whether the replicas is 0</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"risk\">Risk <a class=\"header-anchor\" href=\"#risk\">#</a></h2>\n<p>Using <code>objectSelector</code> in <a href=\"https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#webhook-configuration\">webhook configuration</a>,\nKruise webhook will only handle those <code>Namespace/CustomResourceDefinition/Deployment/StatefulSet/ReplicaSet</code> resources with <code>policy.kruise.io/delete-protection</code> label.</p>\n<p>So, if all kruise-manager Pods are crashed or in other abnormal states, kube-apiserver fails to call the deletion webhook,\nonly the resources with <code>policy.kruise.io/delete-protection</code> label can not be deleted temporarily.</p>\n",
  "link": "/en-us/docs/deletion_protection.html",
  "meta": {
    "title": "Deletion Protection"
  }
}