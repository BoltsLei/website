{
  "filename": "go_client.md",
  "__html": "<h1>Golang client</h1>\n<p>If you want to create/get/update/delete those OpenKruise resources in a Golang project or list-watch them using informer,\nyou may need a Golang client for OpenKruise.</p>\n<p>Although Kruise have generated clientset/informers/listers in this <a href=\"https://github.com/openkruise/kruise/tree/master/pkg/client\">pkg/client</a> directory, we strongly deprecate the use of this client, for it will brings the whole kruise repo into your <code>go.mod</code> or <code>vendor</code>, which might cause dependencies more complicated.</p>\n<p>We recommend users just use <a href=\"https://github.com/openkruise/kruise-api\">kruise-api</a> which only includes schema of the API types that are served by Kruise.</p>\n<p>The <a href=\"https://github.com/openkruise/kruise-api\">kruise-api</a> library is the canonical location of the Kruise API definition.\nActually, it is synced from <code>https://github.com/openkruise/kruise/tree/master/pkg/apis</code>. All changes must be made in the latter. The former is read-only.</p>\n<h2>Usage</h2>\n<p><a href=\"https://github.com/kubernetes-sigs/controller-runtime\">controller-runtime</a> is the best way to use <code>kruise-api</code>:</p>\n<ul>\n<li>If your project is generated by <a href=\"https://github.com/kubernetes-sigs/kubebuilder\">kubebuilder</a> or <a href=\"https://github.com/operator-framework/operator-sdk\">operator-sdk</a>, it means <code>controller-runtime</code> is already imported in your repo.</li>\n<li>Otherwrise, you may add it into your <code>go.mod</code> along with kruise-api.</li>\n</ul>\n<h3>1. Add kruise scheme</h3>\n<pre><code class=\"language-go\"><span class=\"hljs-keyword\">import</span> kruiseapps <span class=\"hljs-string\">\"github.com/openkruise/kruise-api/apps/v1alpha1\"</span>\n\n<span class=\"hljs-comment\">// ...</span>\n_ = kruiseapps.AddToScheme(scheme)\n</code></pre>\n<h3>2. New client</h3>\n<p>This is needed when use controller-runtime client directly.</p>\n<p>If your project is generated by <a href=\"https://github.com/kubernetes-sigs/kubebuilder\">kubebuilder</a> or <a href=\"https://github.com/operator-framework/operator-sdk\">operator-sdk</a>, you should get the client from <code>mgr.GetClient()</code> instead of the example below.</p>\n<pre><code class=\"language-go\"><span class=\"hljs-keyword\">import</span> <span class=\"hljs-string\">\"sigs.k8s.io/controller-runtime/pkg/client\"</span>\n\napiClient, err := client.New(c, client.Options{Scheme: scheme})\n</code></pre>\n<h3>3. Get/List</h3>\n<pre><code class=\"language-go\"><span class=\"hljs-keyword\">import</span> (\n    kruiseapps <span class=\"hljs-string\">\"github.com/openkruise/kruise-api/apps/v1alpha1\"</span>\n    <span class=\"hljs-string\">\"sigs.k8s.io/controller-runtime/pkg/client\"</span>\n)\n\ncloneSet := kruiseapps.CloneSet{}\nerr = apiClient.Get(context.TODO(), types.NamespacedName{Namespace: namespace, Name: name}, &amp;cloneSet)\n\ncloneSetList := kruiseapps.CloneSetList{}\nerr = apiClient.List(context.TODO(), &amp;cloneSetList, client.InNamespace(instance.Namespace))\n</code></pre>\n<h3>4. Create/Update/Delete</h3>\n<p>Create a new CloneSet:</p>\n<pre><code class=\"language-go\"><span class=\"hljs-keyword\">import</span> kruiseapps <span class=\"hljs-string\">\"github.com/openkruise/kruise-api/apps/v1alpha1\"</span>\n\ncloneSet := kruiseapps.CloneSet{\n    <span class=\"hljs-comment\">// ...</span>\n}\nerr = apiClient.Create(context.TODO(), &amp;cloneSet)\n</code></pre>\n<p>Update an existing CloneSet:</p>\n<pre><code class=\"language-go\"><span class=\"hljs-keyword\">import</span> kruiseapps <span class=\"hljs-string\">\"github.com/openkruise/kruise-api/apps/v1alpha1\"</span>\n\n<span class=\"hljs-comment\">// Get first</span>\ncloneSet := kruiseapps.CloneSet{}\n<span class=\"hljs-keyword\">if</span> err = apiClient.Get(context.TODO(), types.NamespacedName{Namespace: namespace, Name: name}, &amp;cloneSet); err != <span class=\"hljs-literal\">nil</span> {\n    <span class=\"hljs-keyword\">return</span> err\n}\n\n<span class=\"hljs-comment\">// Modify object, such as replicas or template</span>\ncloneSet.Spec.Replicas = utilpointer.Int32Ptr(<span class=\"hljs-number\">5</span>)\n\n<span class=\"hljs-comment\">// Update</span>\n<span class=\"hljs-comment\">// This might get conflict, should retry it</span>\n<span class=\"hljs-keyword\">if</span> err = apiClient.Update(context.TODO(), &amp;cloneSet); err != <span class=\"hljs-literal\">nil</span> {\n    <span class=\"hljs-keyword\">return</span> err\n}\n</code></pre>\n<h3>5. List watch and informer</h3>\n<p>If your project is generated by <a href=\"https://github.com/kubernetes-sigs/kubebuilder\">kubebuilder</a> or <a href=\"https://github.com/operator-framework/operator-sdk\">operator-sdk</a> and get the client from <code>mgr.GetClient()</code>, then methods like <code>Get</code>/<code>List</code> have already queried from informer instead of apiserver.</p>\n",
  "link": "/en-us/docs/go_client.html",
  "meta": {}
}