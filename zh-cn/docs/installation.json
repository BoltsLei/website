{
  "filename": "installation.md",
  "__html": "<h1>安装 OpenKruise</h1>\n<h2>安装前检查</h2>\n<p>Kruise 需要 Kube-apiserver 启用一些功能如 <code>MutatingAdmissionWebhook</code> 和 <code>ValidatingAdmissionWebhook</code>。</p>\n<p>如果你的 Kubernetes 版本低于 v1.12，在安装前要先在本地执行如下的脚本来校验是否满足：</p>\n<blockquote>\n<p>注意，这个脚本需要对本地 /tmp 目录有读写权限，并且先配置好本地 kubectl 能够连接目标集群。</p>\n</blockquote>\n<pre><code class=\"language-shell\"><span class=\"hljs-meta\">$</span><span class=\"bash\"> sh -c <span class=\"hljs-string\">\"<span class=\"hljs-variable\">$(curl -fsSL https://raw.githubusercontent.com/openkruise/kruise/master/scripts/check_for_installation.sh)</span>\"</span></span>\nSuccessfully check for installation, you can install kruise now.\n</code></pre>\n<h2>通过 helm charts 安装</h2>\n<p>目前最新的 Kruise 稳定版本是 <code>v0.5.0</code>。我们建议你采用 helm v3 来安装 Kruise，helm 是一个简单的命令行工具可以从<a href=\"https://github.com/helm/helm/releases\">这里</a>获取。</p>\n<pre><code class=\"language-shell\"><span class=\"hljs-meta\">$</span><span class=\"bash\"> helm install kruise https://github.com/openkruise/kruise/releases/download/v0.5.0/kruise-chart.tgz</span>\nNAME: kruise\nLAST DEPLOYED: Mon Jun 15 20:00:00 2020\nNAMESPACE: default\nSTATUS: deployed\nREVISION: 1\nTEST SUITE: None\n</code></pre>\n<h3>可选: chart 安装参数</h3>\n<p>注意直接安装 chart 会使用默认的 template values，你也可以根据你的集群情况指定一些特殊配置，比如修改 resources 限制或者只启用某些特定的控制器能力。</p>\n<p>下表展示了 chart 所有可配置的参数和它们的默认值：</p>\n<table>\n<thead>\n<tr>\n<th>参数</th>\n<th>描述</th>\n<th>默认值</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>log.level</code></td>\n<td>kruise-manager 输出的日志级别</td>\n<td><code>4</code></td>\n</tr>\n<tr>\n<td><code>manager.resources.limits.cpu</code></td>\n<td>kruise-manager 容器的 CPU limit 配置</td>\n<td><code>100m</code></td>\n</tr>\n<tr>\n<td><code>manager.resources.limits.memory</code></td>\n<td>kruise-manager 容器的 Memory limit 配置</td>\n<td><code>256Mi</code></td>\n</tr>\n<tr>\n<td><code>manager.resources.requests.cpu</code></td>\n<td>kruise-manager 容器的 CPU request 配置</td>\n<td><code>100m</code></td>\n</tr>\n<tr>\n<td><code>manager.resources.requests.memory</code></td>\n<td>kruise-manager 容器的 Memory request 配置</td>\n<td><code>256Mi</code></td>\n</tr>\n<tr>\n<td><code>manager.metrics.addr</code></td>\n<td>Metrics server 绑定地址</td>\n<td><code>localhost</code></td>\n</tr>\n<tr>\n<td><code>manager.metrics.port</code></td>\n<td>Metrics server 绑定端口</td>\n<td><code>8080</code></td>\n</tr>\n<tr>\n<td><code>manager.custom_resource_enable</code></td>\n<td>只启用特定的 CRD 资源</td>\n<td><code>&quot;&quot;</code>(空表示所有都启用)</td>\n</tr>\n<tr>\n<td><code>spec.nodeAffinity</code></td>\n<td>kruise-manager pod 的 nodeAffinity 配置</td>\n<td><code>{}</code></td>\n</tr>\n<tr>\n<td><code>spec.nodeSelector</code></td>\n<td>kruise-manager pod 的 nodeSelector 配置</td>\n<td><code>{}</code></td>\n</tr>\n<tr>\n<td><code>spec.tolerations</code></td>\n<td>kruise-manager pod 的 tolerations 配置</td>\n<td><code>[]</code></td>\n</tr>\n</tbody>\n</table>\n<p>这些参数可以通过 <code>--set key=value[,key=value]</code> 参数在 <code>helm install</code> 命令中生效。</p>\n<h3>可选: 启用特定 CRD 功能</h3>\n<p>如果你只需要使用某些 Kruise 中的控制器并关闭其他的控制器，你可以做以下两个方式或同时做：</p>\n<ol>\n<li>只安装你需要使用的 CRD。</li>\n<li>在 kruise-manager 容器中设置 <code>CUSTOM_RESOURCE_ENABLE</code> 环境变量，指定你需要启用的 CRD 名字。在 helm chart 安装的时候可以使用以下参数：</li>\n</ol>\n<pre><code class=\"language-shell\"><span class=\"hljs-meta\">$</span><span class=\"bash\"> helm install kruise https://github.com/openkruise/kruise/releases/download/v0.5.0/kruise-chart.tgz --<span class=\"hljs-built_in\">set</span> manager.custom_resource_enable=<span class=\"hljs-string\">\"CloneSet\\,SidecarSet\"</span></span>\n</code></pre>\n<p>比如，<code>CUSTOM_RESOURCE_ENABLE=CloneSet,SidecarSet</code> 表示只启用 CloneSet 和 SidecarSet 的 controller/ webhook，其他资源的 controllers/webhooks 都会关闭。</p>\n<h2>卸载</h2>\n<p>注意：卸载会导致所有 Kruise 下的资源都会删除掉，包括 webhook configurations, services, namespace, CRDs, CR instances 以及所有 Kruise workload 下的 Pod。 请务必谨慎操作！</p>\n<p>卸载使用 helm chart 安装的 Kruise：</p>\n<pre><code class=\"language-shell\"><span class=\"hljs-meta\">$</span><span class=\"bash\"> helm uninstall kruise</span>\nrelease \"kruise\" uninstalled\n</code></pre>\n",
  "link": "/zh-cn/docs/installation.html",
  "meta": {}
}